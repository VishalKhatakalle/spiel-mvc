@model List<Blog>

@{
    var allYears = Model.Select(b => b.PublishedAt.Year).Distinct().OrderByDescending(y => y).ToList();
    var allMonths = Model.Select(b => b.PublishedAt.ToString("MMMM")).Distinct().ToList();
    var allCategories = Model.Select(b => b.Category).Where(c => !string.IsNullOrEmpty(c)).Distinct().ToList();

    string selectedYear = Context.Request.Query["year"];
    string selectedMonth = Context.Request.Query["month"];
    string selectedCategory = Context.Request.Query["category"];

    var filtered = Model.AsEnumerable();
    if (!string.IsNullOrEmpty(selectedYear))
        filtered = filtered.Where(b => b.PublishedAt.Year.ToString() == selectedYear);
    if (!string.IsNullOrEmpty(selectedMonth))
        filtered = filtered.Where(b => b.PublishedAt.ToString("MMMM") == selectedMonth);
    if (!string.IsNullOrEmpty(selectedCategory))
        filtered = filtered.Where(b => b.Category == selectedCategory);

    var groupedByDate = filtered
        .GroupBy(b => b.PublishedAt.ToShortDateString())
        .OrderByDescending(g => DateTime.Parse(g.Key));
}

<div class="p-6 max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold mb-8">Blog Timeline</h2>

    <!-- Filter Dropdowns -->
    <form method="get" class="flex flex-wrap gap-4 mb-8">
        <select name="year" class="select select-bordered">
            <option value="">Year</option>
            @foreach (var year in allYears)
            {
                <option value="@year" selected="@(selectedYear == year.ToString())">@year</option>
            }
        </select>

        <select name="month" class="select select-bordered">
            <option value="">Month</option>
            @foreach (var month in allMonths)
            {
                <option value="@month" selected="@(selectedMonth == month)">@month</option>
            }
        </select>

        <select name="category" class="select select-bordered">
            <option value="">Category</option>
            @foreach (var cat in allCategories)
            {
                <option value="@cat" selected="@(selectedCategory == cat)">@cat</option>
            }
        </select>

        <button type="submit" class="btn btn-primary">Filter</button>
    </form>

    <!-- Custom Vertical Timeline -->
    <div class="relative pl-6 border-l border-primary">
        @foreach (var group in groupedByDate)
        {
            <div class="mb-10 ml-4">
                <!-- Timeline Dot -->
                <div class="absolute -left-[7px] top-2 w-4 h-4 rounded-full bg-primary"></div>

                <!-- Date Label -->
                <div class="text-sm text-gray-500 font-mono italic">@group.Key</div>

                <!-- Blog Cards -->
                <div class="mt-3 overflow-x-auto">
                    <div class="flex gap-4 pb-2">
                        @foreach (var blog in group)
                        {
                            <div class="card w-80 bg-base-100 shadow-sm shrink-0">
                                @if (!string.IsNullOrEmpty(blog.CoverImageUrl))
                                {
                                    <figure class="h-40 overflow-hidden">
                                        <img src="@blog.CoverImageUrl" alt="@blog.Title" class="object-cover w-full h-full" />
                                    </figure>
                                }

                                <div class="card-body">
                                    <h3 class="card-title text-base">@blog.Title</h3>
                                    <p class="text-sm opacity-70">
                                        @blog.User?.UserName ?? "Unknown Author" Â· @blog.Category
                                    </p>
                                    <p class="line-clamp-3 text-sm">@blog.Description</p>

                                    <div class="flex flex-wrap gap-1 mt-1">
                                        @foreach (var tag in blog.TagList)
                                        {
                                            <span class="badge badge-outline badge-sm">@tag</span>
                                        }
                                    </div>

                                    <div class="card-actions justify-end mt-2">
                                        <a class="btn btn-xs btn-primary" asp-action="Detail" asp-route-slug="@blog.Slug">Read More</a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>